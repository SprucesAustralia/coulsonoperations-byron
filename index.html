<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spruces Cleaning - Contract & Photos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* 
      Black & White + Readable Font
      Designed for mobile screens
    */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      background-color: #fff;
      color: #000;
      font-family: Arial, sans-serif;
      line-height: 1.5;
      padding: 10px;
    }
    h1, h2, h3, h4 {
      margin-bottom: 10px;
      font-weight: normal;
    }
    h1 {
      margin-top: 0;
      font-size: 1.4rem;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    .section {
      margin-bottom: 20px;
    }

    /* Form & Input Styles */
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 0.9rem;
    }
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      font-size: 1rem;
      border-radius: 4px;
      color: #333;
    }
    select {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      font-size: 1rem;
      border-radius: 4px;
    }
    .button {
      display: inline-block;
      padding: 10px 15px;
      margin-right: 5px;
      background-color: #000;
      color: #fff;
      border: none;
      border-radius: 4px;
      text-decoration: none;
      cursor: pointer;
      font-size: 1rem;
    }
    .button:hover {
      background-color: #555;
    }

    /* Signature Canvas */
    #signature-container {
      border: 1px solid #ccc;
      margin-bottom: 10px;
      position: relative;
      touch-action: none;
    }
    #signature-canvas {
      width: 100%;
      height: 200px;
      background-color: #f9f9f9;
    }
    #clear-signature {
      background-color: #ccc;
      color: #000;
      margin-bottom: 10px;
    }
    
    /* Drag-and-Drop Zone */
    .dropzone {
      border: 2px dashed #ccc;
      padding: 20px;
      text-align: center;
      margin-bottom: 15px;
      border-radius: 4px;
    }
    .dropzone.dragover {
      border-color: #000;
    }
    .dropzone p {
      margin-bottom: 10px;
      font-size: 0.9rem;
    }
    .dropzone input[type="text"] {
      margin-top: 5px;
    }

    /* Image Gallery / Thumbnails */
    .thumbnails {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .thumbnail {
      position: relative;
      width: 80px;
      height: 80px;
      background-color: #eee;
      border: 1px solid #ccc;
      overflow: hidden;
      cursor: pointer;
    }
    .thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Image Overlay */
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 999;
    }
    #overlay img {
      max-width: 90%;
      max-height: 90%;
    }

    /* Hidden Fields */
    .hidden {
      display: none;
    }

    /* Additional minor styling */
    .agreement-text {
      font-size: 0.9rem;
      background-color: #f2f2f2;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
      color: #333;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Spruces Cleaning Contract & Photos</h1>

  <!-- FORM: Posts to Formspree with all data -->
  <form id="mainForm" action="https://formspree.io/f/mgvoljgr" method="POST" enctype="multipart/form-data">

    <!-- Agreement Section -->
    <div class="section" id="agreement-section">
      <h2>1. Agreement Details</h2>
      <div class="agreement-text">
        <p>This agreement is made between Spruces Cleaning Company ("the Company") and the Cleaner.</p>
        <p>By signing and submitting this form, you acknowledge and agree to all the terms of the contract.</p>
        <p>Payment: 50% upon required documentation submission, 50% once the client is satisfied.</p>
        <!-- ... add your terms and conditions text as needed ... -->
      </div>

      <!-- Name, Email, Phone, Address, Bank Details -->
      <label for="fullName">Full Name</label>
      <input type="text" name="fullName" id="fullName" required>

      <label for="email">Email</label>
      <input type="email" name="email" id="email" required>

      <label for="phone">Phone</label>
      <input type="tel" name="phone" id="phone" required>

      <label for="address">Address</label>
      <input type="text" name="address" id="address" required>

      <label for="bankDetails">Bank Details (BSB & Account No.)</label>
      <input type="text" name="bankDetails" id="bankDetails" required>
    </div>

    <!-- Signature Section -->
    <div class="section" id="signature-section">
      <h2>2. Signature</h2>
      <p>Please sign below (finger on mobile or mouse on desktop).</p>
      <div id="signature-container">
        <canvas id="signature-canvas"></canvas>
      </div>
      <button type="button" class="button" id="clear-signature">Clear Signature</button>

      <!-- Hidden input to store signature data as Base64 -->
      <input type="hidden" name="signatureData" id="signatureData" value="">
    </div>

    <!-- BEFORE Pictures Section -->
    <div class="section" id="before-pics-section">
      <h2>3. Before Pictures</h2>
      <div class="dropzone" id="dropzoneBefore">
        <p>Drag & Drop or Click to Upload a “Before” Photo</p>
        <label for="beforeLabel">Label (e.g. "Living Room Before")</label>
        <input type="text" id="beforeLabel" placeholder="Label this photo..." />
      </div>
      <!-- Thumbnails of uploaded BEFORE images -->
      <div class="thumbnails" id="beforeThumbnails"></div>
    </div>

    <!-- AFTER Pictures Section -->
    <div class="section" id="after-pics-section">
      <h2>4. After Pictures</h2>
      <div class="dropzone" id="dropzoneAfter">
        <p>Drag & Drop or Click to Upload an “After” Photo</p>
        <label for="afterLabel">Label (e.g. "Living Room After")</label>
        <input type="text" id="afterLabel" placeholder="Label this photo..." />
      </div>
      <!-- Thumbnails of uploaded AFTER images -->
      <div class="thumbnails" id="afterThumbnails"></div>
    </div>

    <!-- Hidden fields to store image data for each BEFORE & AFTER upload -->
    <!-- If multiple images needed, replicate the logic or store them in arrays. -->
    <input type="hidden" name="beforeImages" id="beforeImages">
    <input type="hidden" name="afterImages" id="afterImages">

    <!-- Submit Button -->
    <button type="submit" class="button">Submit Contract</button>
  </form>

  <!-- IMAGE OVERLAY for full-size preview -->
  <div id="overlay">
    <img src="#" alt="Full Image Preview" id="overlayImg">
  </div>

</div> <!-- end container -->

<script>
  /* 
   * 1) SIGNATURE CANVAS
   */
  const signatureCanvas = document.getElementById('signature-canvas');
  const signatureContainer = document.getElementById('signature-container');
  const clearSignatureBtn = document.getElementById('clear-signature');
  const signatureDataInput = document.getElementById('signatureData');

  let signaturePad, ctx, drawing = false;

  // Resize the canvas to fit container width
  function resizeCanvas() {
    signatureCanvas.width = signatureContainer.clientWidth;
    signatureCanvas.height = 200; // fixed height
    ctx = signatureCanvas.getContext('2d');
    ctx.fillStyle = "#ffffff"; // White background
    ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // Canvas drawing events
  function startDrawing(e) {
    drawing = true;
    ctx.beginPath();
    ctx.moveTo(getX(e), getY(e));
    e.preventDefault();
  }
  function draw(e) {
    if(!drawing) return;
    ctx.lineTo(getX(e), getY(e));
    ctx.strokeStyle = "#000";
    ctx.lineWidth = 2;
    ctx.stroke();
    e.preventDefault();
  }
  function stopDrawing(e) {
    if(!drawing) return;
    drawing = false;
    e.preventDefault();
  }
  function getX(e) {
    if(e.type.includes('touch')) {
      return e.touches[0].clientX - signatureCanvas.getBoundingClientRect().left;
    }
    return e.clientX - signatureCanvas.getBoundingClientRect().left;
  }
  function getY(e) {
    if(e.type.includes('touch')) {
      return e.touches[0].clientY - signatureCanvas.getBoundingClientRect().top;
    }
    return e.clientY - signatureCanvas.getBoundingClientRect().top;
  }

  signatureCanvas.addEventListener('mousedown', startDrawing);
  signatureCanvas.addEventListener('mousemove', draw);
  signatureCanvas.addEventListener('mouseup', stopDrawing);
  signatureCanvas.addEventListener('mouseleave', stopDrawing);

  signatureCanvas.addEventListener('touchstart', startDrawing, {passive: false});
  signatureCanvas.addEventListener('touchmove', draw, {passive: false});
  signatureCanvas.addEventListener('touchend', stopDrawing, {passive: false});
  
  clearSignatureBtn.addEventListener('click', () => {
    ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
  });

  /* 
   * 2) DRAG & DROP IMAGE UPLOAD
   *    - We'll store one image (Base64) for BEFORE, and one image for AFTER 
   *      to show the logic. 
   *    - If you need multiples, replicate or store in arrays.
   *    - Once uploaded, we disable further changes to that zone.
   */

  const dropzoneBefore = document.getElementById('dropzoneBefore');
  const dropzoneAfter = document.getElementById('dropzoneAfter');

  const beforeThumbnails = document.getElementById('beforeThumbnails');
  const afterThumbnails = document.getElementById('afterThumbnails');

  const beforeImagesInput = document.getElementById('beforeImages');
  const afterImagesInput = document.getElementById('afterImages');

  let beforeUploaded = false;
  let afterUploaded = false;

  // Helper: handle drag events
  function handleDragOver(e) {
    e.preventDefault();
    e.currentTarget.classList.add('dragover');
  }
  function handleDragLeave(e) {
    e.currentTarget.classList.remove('dragover');
  }

  dropzoneBefore.addEventListener('dragover', handleDragOver);
  dropzoneBefore.addEventListener('dragleave', handleDragLeave);
  dropzoneAfter.addEventListener('dragover', handleDragOver);
  dropzoneAfter.addEventListener('dragleave', handleDragLeave);

  dropzoneBefore.addEventListener('drop', (e) => handleDrop(e, 'before'));
  dropzoneAfter.addEventListener('drop', (e) => handleDrop(e, 'after'));

  // Also handle click to open file dialog
  dropzoneBefore.addEventListener('click', () => {
    if(!beforeUploaded) {
      openFileDialog('before');
    }
  });
  dropzoneAfter.addEventListener('click', () => {
    if(!afterUploaded) {
      openFileDialog('after');
    }
  });

  function openFileDialog(type) {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.onchange = (e) => {
      const file = e.target.files[0];
      if(file) {
        processFile(file, type);
      }
    };
    fileInput.click();
  }

  function handleDrop(e, type) {
    e.preventDefault();
    e.currentTarget.classList.remove('dragover');
    if((type === 'before' && beforeUploaded) || (type === 'after' && afterUploaded)) {
      return; // do nothing if already uploaded
    }
    const file = e.dataTransfer.files[0];
    if(file) {
      processFile(file, type);
    }
  }

  function processFile(file, type) {
    const labelId = (type === 'before') ? 'beforeLabel' : 'afterLabel';
    const labelValue = document.getElementById(labelId).value.trim();
    if(!labelValue) {
      alert('Please enter a label before uploading the image.');
      return;
    }
    const reader = new FileReader();
    reader.onload = function(evt) {
      const base64 = evt.target.result; // base64 data
      displayThumbnail(base64, labelValue, type);
      storeImageData(base64, labelValue, type);
      // Mark as uploaded so they can't change
      if(type === 'before') {
        beforeUploaded = true;
      } else {
        afterUploaded = true;
      }
      disableDropzone(type);
    };
    reader.readAsDataURL(file);
  }

  function displayThumbnail(base64, label, type) {
    const container = (type === 'before') ? beforeThumbnails : afterThumbnails;

    // Create a thumbnail
    const thumbDiv = document.createElement('div');
    thumbDiv.classList.add('thumbnail');

    // Show label in a title attribute or a small overlay
    thumbDiv.title = label;

    const img = document.createElement('img');
    img.src = base64;
    thumbDiv.appendChild(img);

    // Clicking the thumbnail => show overlay
    thumbDiv.addEventListener('click', () => {
      showOverlay(base64);
    });

    container.appendChild(thumbDiv);
  }

  function storeImageData(base64, label, type) {
    // We'll store them as JSON in a hidden field: [{label:..., data:...}]
    const hiddenInput = (type === 'before') ? beforeImagesInput : afterImagesInput;
    let stored = [];
    if(hiddenInput.value) {
      try { stored = JSON.parse(hiddenInput.value); } catch(e) {}
    }
    stored.push({ label, data: base64 });
    hiddenInput.value = JSON.stringify(stored);
  }

  function disableDropzone(type) {
    const dropzone = (type === 'before') ? dropzoneBefore : dropzoneAfter;
    // We can grey it out or add some text
    dropzone.style.pointerEvents = 'none';
    dropzone.style.opacity = '0.5';
  }

  /*
   * IMAGE OVERLAY (Full-Size Preview)
   */
  const overlay = document.getElementById('overlay');
  const overlayImg = document.getElementById('overlayImg');

  function showOverlay(base64) {
    overlayImg.src = base64;
    overlay.style.display = 'flex';
  }

  overlay.addEventListener('click', () => {
    overlay.style.display = 'none';
  });

  /*
   * 3) On form submission, convert signature canvas to Base64
   *    and store in hidden field. Then let the form submit.
   */
  const mainForm = document.getElementById('mainForm');
  mainForm.addEventListener('submit', (e) => {
    // Convert signature to Base64
    const dataURL = signatureCanvas.toDataURL('image/png');
    signatureDataInput.value = dataURL;
  });
</script>
</body>
</html>
